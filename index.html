<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>GPT + Stockfish Chess Tutor</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chess.js@0.12.0/chess.min.js"></script>
  <style>
    body { font-family: Arial; text-align: center; padding: 20px; }
    #board { width: 400px; margin: auto; }
    textarea { width: 80%; height: 120px; margin-top: 20px; }
  </style>
</head>
<body>
  <h2>♟ GPT + Stockfish Chess Tutor</h2>
  <div id="board"></div>
  <button id="analyzeBtn">이 위치 분석하기</button>
  <h3>엔진 요약</h3>
  <textarea id="summary" readonly></textarea>
  <h3>GPT 해설</h3>
  <textarea id="explanation" readonly></textarea>

  <script>
    const board = Chessboard('board', { draggable: true, position: 'start' });
    const game = new Chess();

    board.onDrop = function(source, target) {
      const move = game.move({from: source, to: target, promotion: 'q'});
      if (move === null) return 'snapback';
      return undefined;
    };

    $('#analyzeBtn').click(async () => {
      const fen = game.fen();
      $("#summary").val("분석 중...");
      $("#explanation").val("");
      const res = await fetch("/analyze", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({
          fen: fen,
          played_san: null,
          level: "beginner",
          depth: 14,
          multipv: 3
        })
      });
      const data = await res.json();
      $("#summary").val(data.summary);
      $("#explanation").val(data.explanation);
    });
  </script>
</body>
</html>